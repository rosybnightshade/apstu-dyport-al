<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome!</title>
    <!--Stylesheets-->
    <link rel="stylesheet" href="/global.css">
    <link rel="stylesheet" href="/studypages/indiv-class.css">
    <!--Scripts-->
    <script src="/studypages/classpages/classes.js" defer></script>
    <!--Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cal+Sans&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <section id="activities" class="activities">

    </section>
</body>
<script>                               
    document.addEventListener("DOMContentLoaded", () => {
    
    let username = sessionStorage.getItem('loggedIn');

    const classFile = JSON.parse(sessionStorage.getItem("currentCourse"));
    
    if (classFile) {
        const header = document.createElement('header');
        header.innerHTML = `
            <h1 class="big-header">Welcome To <br> <span id="inverse" class="accent">${classFile.class}</span></h1>
        `;
        document.body.prepend(header);

        const checkComplete = document.createElement('div');
        checkComplete.id = 'checked'
        header.prepend(checkComplete);

        let status = "Not Yet Completed"
        const savedStatus = getCompletionCookie(username, "courseStatus");
        if (savedStatus) {
            status = savedStatus;
        }
        checkComplete.innerHTML = 
        `
        <h4>This Course Has Been ${status}</h4>
        `
        checkComplete.style.backgroundColor = 'red';
        checkComplete.style.display = 'flex';
        checkComplete.style.placeItems = 'center';
        checkComplete.style.padding = '5px';
        checkComplete.style.height = '50px';
        header.style.display = 'flex';

        checkComplete.addEventListener('click', handleCompletion);

        function getCompletionCookie(username, key, status) {
            const name  = `${username}_${key}=`
            const cookies = document.cookie
                .split('; ')
                .find(row => row.startsWith(name));
                return cookies ? cookies.split('=')[1] : null;
            
        }

        function setCompletionCookie(username, key, status) {
            const courseCookie = `${username}_${key}`
            document.cookie = `${courseCookie}=${status};`
        }

        function handleCompletion() {
        if (status == "Not Yet Completed") {
            status = "Completed"
            checkComplete.style.backgroundColor = 'green';
            checkComplete.innerHTML = `
?            <h4>This Course Has Been ${status}</h4>
            `
            setCompletionCookie(username, "courseStatus", status);
            
        } else {
            status = "Not Yet Completed"
            checkComplete.style.backgroundColor = 'red';
            checkComplete.innerHTML = `
            <h4>This Course Has Been ${status}</h4>
            `
            setCompletionCookie(username, "courseStatus", status);
        }
    }
    }

    if (classFile.flashcards == true) {
        const section = document.createElement('section');
        const whole = document.getElementById('activities')
        section.innerHTML = `
            <div class="act" id="flashcards">
                <h4><a href="flashcards.html">Flashcards</a><h4>
                <img src='/studypages/class%20icons/flashcards.svg'>
            </div>
        `
        whole.appendChild(section);
    }

    if (classFile.notes == true) {
        const section = document.createElement('section');
        const whole = document.getElementById('activities')
        section.innerHTML = `
            <div class="act" id="notes">
                <h4> Notes <h4>
                <img src='/studypages/class%20icons/notes.svg'>
            </div>
        `
        whole.appendChild(section);
    }
});
</script>
</html>